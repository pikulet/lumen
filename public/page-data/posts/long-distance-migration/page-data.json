{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/long-distance-migration","result":{"data":{"markdownRemark":{"id":"3790385c-f814-5f17-81a3-182e0d31b22a","html":"<p>TCP is a protocol used for reliable data transfer. For each piece of data that Iâ€™m sending to you, I would expect a reply or acknowledgement (ACK) that you have received this reply. To improve the network throughput, TCP communication also involves a sliding window, where multiple sequenced messages can be sent out, and the replies can come back in any order.</p>\n<h3 id=\"issues-with-long-rtt-communication\" style=\"position:relative;\"><a href=\"#issues-with-long-rtt-communication\" aria-label=\"issues with long rtt communication permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Issues with long RTT communication</h3>\n<p>When this communcation occurs over long physical distances (e.g. from Singapore to US), then the time taken for a message to reach US and then its ACK to return to Singapore is long. We call this the long RTT (Round-Trip Time) scenario.</p>\n<p>In such a case, we would need to send a very large number of in-flight messages to counteract the effect of the long RTT and maintain the same throuhgput. However, having a lot of in-flight messages (e.g. 100k) also means that there has to be an in-memory tracker for all of these messages.</p>\n<h3 id=\"optimisation-batch-processing\" style=\"position:relative;\"><a href=\"#optimisation-batch-processing\" aria-label=\"optimisation batch processing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Optimisation: Batch Processing</h3>\n<p>One way to reduce the number of in-flight messages is to package multiple messages into one large packet. This method of <strong>batch processing</strong> means that with just one in-flight message, we have in reality sent 1000 messages to the recipient.</p>\n<p>Batch processing is a generic optimisation that simply concatenates multiple messages together. It can be applied in a multitude of long RTT communication scenarios.</p>\n<h3 id=\"optimisation-concurrency\" style=\"position:relative;\"><a href=\"#optimisation-concurrency\" aria-label=\"optimisation concurrency permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Optimisation: Concurrency</h3>\n<p>Messages can be sent <strong>concurrently</strong>, so one message need not wait for its predecessor to first return. The correctness of concurrency is application-specific. For database migrations, different tables would be independent of each other. Furthermore, different primary keys are also independent of each other. This means that we only need to ensure the in-order correctness of messages with the same table and same primary key. Data sharding is key in increasing concurrency.</p>\n<h3 id=\"optimisation-message-compression\" style=\"position:relative;\"><a href=\"#optimisation-message-compression\" aria-label=\"optimisation message compression permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Optimisation: Message Compression</h3>\n<p>There are also application-specific optimisations that can be performed to compress the messages (besides binary compression algorithms). For instance, in the case of database migration, we can also <strong>compress messages by merging them</strong>. Two database operations on the same primary key can be merged to one operation, using the following steps.</p>\n<ul>\n<li><code class=\"language-text\">x + DELETE --> NONE</code></li>\n<li><code class=\"language-text\">INSERT + UPDATE --> INSERT</code></li>\n<li><code class=\"language-text\">UPDATE + UPDATE --> UPDATE</code></li>\n<li><code class=\"language-text\">DELETE + INSERT --> UPDATE (with default values)</code></li>\n</ul>\n<p>These transformation functions can be composed together, merging a large number of messages to just one.</p>","fields":{"slug":"/posts/long-distance-migration","tagSlugs":["/tag/database/"]},"frontmatter":{"date":"2022-04-14","description":"Improving the throughput of long RTT networks","tags":["database"],"title":"Long Round-Trip Time (RTT) Optimisations"}}},"pageContext":{"slug":"/posts/long-distance-migration"}},"staticQueryHashes":["251939775","3439816877","401334301"]}